version: 2.1

steps: &steps
  working_directory: /operator-mode
  steps:
    - run:
        name: ERT tests
        command: |
          emacs -Q --batch \
--eval \"(message (emacs-version))\" \\
--eval \"(setq operator-mode-debug nil)\" \\
--eval \"(setq python-indent-offset 4)\" \\
--eval \"(setq python-indent-guess-indent-offset nil)\" \\
--eval \"(setq python-indent-guess-indent-offset-verbose nil)\" \\
-load $FILE1 \
\
-load $TEST1 \
-load $TEST3 \
-load $TEST4 \
-f ert-run-tests-batch-and-exit

jobs:
  emacs-27:
    docker:
      - image: silex/emacs:27.2
    <<: *steps
  emacs-26:
    docker:
      - image: silex/emacs:26.3
    <<: *steps
  emacs-25:
    docker:
      - image: silex/emacs:25.3
    <<: *steps

workflows:
  version: 2
  build:
    jobs:
      - emacs-25
      - emacs-26
      - emacs-27

